{% extends path(aplicacion.ruta) ~ '/admin/cuestionario/index.html.twig' %}

{% block content %}
    <div class="pagina-titulo">{{ titulo }}</div>

    <div class="container-fluid py-4 g-4">
        <div class="row py-2">
            <div class="fila-campo">Estado</div>
            <div class="fila-valor">
                {%- if cuestionario.estado -%}
                    <span class="me-1 text-{{ cuestionario.estado.color }} fas {{ cuestionario.estado.icono|default }}"></span>
                    {{- cuestionario.estado.nombre -}}
                {%- else -%}
                    <span class="badge-warning text-bg-warning">No definido</span>
                {%- endif -%}
            </div>
        </div>
        <div class="row py-2">
            <div class="fila-campo">Código</div>
            <div class="fila-valor">{{ cuestionario.codigo }}</div>
        </div>
        <div class="row py-2">
            <div class="fila-campo">Título</div>
            <div class="fila-valor">{{ cuestionario.titulo }}</div>
        </div>
        <div class="row py-2">
            <div class="fila-campo">Descripción</div>
            <div class="fila-valor">{{ cuestionario.descripcion|raw }}</div>
        </div>
        <div class="row py-2">
            <div class="fila-campo">Mensaje de bienvenida</div>
            <div class="fila-valor">{{ cuestionario.bienvenida|raw }}</div>
        </div>
        <div class="row py-2">
            <div class="fila-campo">Mensaje de despedida</div>
            <div class="fila-valor">{{ cuestionario.despedida|raw }}</div>
        </div>
        <div class="row py-2">
            <div class="fila-campo">Tipo de formulario</div>
            <div class="fila-valor">
                {{- cuestionario.privado ? 'privado (solo usuarios registrados), ' : 'público, ' -}}
                {{- cuestionario.editable ? 'editable' : 'no editable' -}}
            </div>
        </div>
        <div class="row py-2">
            <div class="fila-campo">Fecha inicio validez</div>
            <div class="fila-valor">
                {{ cuestionario.fechaAlta ? cuestionario.fechaAlta|date('d/m/Y') : 'no establecida' }}
            </div>
        </div>
        <div class="row py-2">
            <div class="fila-campo">Fecha fin validez</div>
            <div class="fila-valor">
                {{ cuestionario.fechaBaja ? cuestionario.fechaBaja|date('d/m/Y') : 'no establecida' }}
            </div>
        </div>
{#        <div class="row py-2">#}
{#            <div class="fila-campo">Cuestionario de aplicación</div>#}
{#            <div class="fila-valor">#}
{#                {%- if cuestionario.aplicacion -%}#}
{#                    <em class="fas {{ cuestionario.aplicacion.icono }}"></em> {{ cuestionario.aplicacion.nombre }}#}
{#                {%- else -%}#}
{#                    genérico#}
{#                {%- endif -%}#}
{#            </div>#}
{#        </div>#}
        <div class="row py-2">
            <div class="fila-campo">Autor</div>
            <div class="fila-valor">{{ cuestionario.autor.persona }}</div>
        </div>
        <div class="row py-2">
            <div class="fila-campo">Preguntas</div>
            <div class="fila-valor">
                {{- cuestionario.grupos|reduce((p, g) => p + g.preguntas|length) }} en {{ cuestionario.grupos|length }} grupos
            </div>
        </div>
        {%- if cuestionario.estado.nombre == constant('App\\Entity\\Sistema\\Estado::PUBLICADO') %}
            <div class="row py-2">
                <div class="fila-campo">URL del formulario</div>
                <div class="fila-valor">
{#                    {{- app.request.schemeAndHttpHost }}/intranet/cuestiona/formulario/{{ cuestionario.url -}}#}
                </div>
            </div>
        {%- endif %}
    </div>
{% endblock %}

{% block botones %}
    <li class="nav-item me-2">
        <a class="btn btn-primary" href="{{ path(aplicacion.ruta ~ '_admin_cuestionario_edit', {'id': cuestionario.id}) }}">
            <span class="fas fa-edit"></span> Editar
        </a>
    </li>
    {%- if cuestionario.estado.nombre == constant('App\\Entity\\Sistema\\Estado::BORRADOR') %}
        <li class="nav-item me-2">
{#            <a id="activa" class="btn btn-primary" href="{{ path(aplicacion.ruta ~ '_admin_cuestionario_activar', {'id': cuestionario.id}) }}">#}
                <span class="fas fa-check"></span> Activar
{#            </a>#}
        </li>
    {%- endif %}
    <li class="nav-item me-2">
{#        <a class="btn btn-primary" href="{{ path(aplicacion.ruta ~ '_admin_grupo_index', {'id': cuestionario.id}) }}">#}
            <span class="fas fa-object-group"></span> Grupos
{#        </a>#}
    </li>
    <li class="nav-item me-2">
        <a id="simula" class="btn btn-primary" href="">
            <span class="fas fa-video"></span> Simular
        </a>
    </li>
{#    {%- if cuestionario.grupos|length == 0 %}#}
{#        <li class="nav-item ms-5 me-2">#}
{#            {{ include(path(aplicacion.ruta) ~ '/admin/cuestionario/_delete_form.html.twig') }}#}
{#        </li>#}
{#    {%- endif %}#}
{% endblock %}

{% block migas %}
    {{ parent() }}
    <li class="breadcrumb-item"><a href="{{ path(aplicacion.ruta ~ '_admin_cuestionario_index') }}">Cuestionarios</a></li>
{% endblock %}

{% block modal %}
    <div class="modal fade" id="simulaInicio" tabindex="-1" aria-hidden="true" data-backdrop="static" data-keyboard="false">
         <div class="modal-dialog modal-xl">
             <div class="modal-content p-4">
                 <div class="h1">{{ cuestionario.titulo }}</div>
                 <div>{{ cuestionario.descripcion|raw }}</div>
                 <div>{{ cuestionario.bienvenida|raw }}</div>
                 <div>
                    <button id="empezar" class="btn btn-primary float-end">Empezar</button>
                 </div>
             </div>
         </div>
    </div>
    <div class="modal fade" id="simulaFin" tabindex="-1" aria-hidden="true" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-xl">
            <div class="modal-content p-4">
                <div class="h1">{{ cuestionario.titulo }}</div>
                <div>{{ cuestionario.despedida|default('<p>Fin del cuestionario.</p>')|raw }}</div>
                <div>
                    <button id="cerrar" class="btn btn-primary float-end">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
    {{ parent() }}
    <script type="module">
        import { Modal } from 'bootstrap';
        const inicio = new Modal('#simulaInicio')
        const fin = new Modal('#simulaFin')
        $('#simula').on('click', function (e) {
            e.preventDefault();
            inicio.show();
        });
        $('#empezar').on('click', function () {
            inicio.hide();
            fin.show();
        });
        $('#cerrar').on('click', function () {
            fin.hide();
        });
        $('#activa').on('click', function () {
            return confirm(
                "Activar un cuestionario implica que ya no podrá ser editado y que se empezarán a recibir respuestas.\n" +
                "¿Continuar?"
            );
        })
    </script>
{% endblock %}